<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Room Buddy - Search</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    {% include 'navbar.html' %}
    <style>.navbar{background-color:transparent;}</style>
    <div class="background-search">
        <div class="container-search">
            <div class="sidebar">
                <h2>Filters</h2>
                <form method="POST" action="{{ url_for('search') }}" class="filter-form">
                    <label for="bedrooms">Bedrooms</label>
                    <select id="bedrooms" name="bedrooms">
                        <option value="" {% if bedrooms == '' %}selected{% endif %}>Any</option>
                        <option value="1" {% if bedrooms == '1' %}selected{% endif %}>1</option>
                        <option value="2" {% if bedrooms == '2' %}selected{% endif %}>2</option>
                        <option value="3" {% if bedrooms == '3' %}selected{% endif %}>3</option>
                        <option value="4" {% if bedrooms == '4' %}selected{% endif %}>4</option>
                        <option value="5" {% if bedrooms == '5' %}selected{% endif %}>5+</option>
                    </select>
                    
                    <label for="bathrooms">Bathrooms</label>
                    <select id="bathrooms" name="bathrooms">
                        <option value="" {% if bathrooms == '' %}selected{% endif %}>Any</option>
                        <option value="1" {% if bathrooms == '1' %}selected{% endif %}>1</option>
                        <option value="2" {% if bathrooms == '2' %}selected{% endif %}>2</option>
                        <option value="3" {% if bathrooms == '3' %}selected{% endif %}>3</option>
                        <option value="4" {% if bathrooms == '4' %}selected{% endif %}>4</option>
                        <option value="5" {% if bathrooms == '5' %}selected{% endif %}>5+</option>
                    </select>
                
                    <label for="city">City</label>
                    <input type="text" id="city" name="city" placeholder="Enter city" value="{{ city }}">
                
                    <label for="rent">Max Rent</label>
                    <input type="number" id="rent" name="rent" placeholder="Enter max rent" value="{{ rent }}">
                
                    <label for="availability">Availability</label>
                    <input type="date" id="availability" name="availability" value="{{ availability }}">
                
                    <label for="gender">Gender Preference</label>
                    <select id="gender" name="gender">
                        <option value="" {% if gender == '' %}selected{% endif %}>Any</option>
                        <option value="male" {% if gender == 'male' %}selected{% endif %}>Male</option>
                        <option value="female" {% if gender == 'female' %}selected{% endif %}>Female</option>
                        <option value="other" {% if gender == 'other' %}selected{% endif %}>Other</option>
                    </select>
                    
                    <button type="submit">Apply Filters</button>
                </form>
                
            </div>
            <div class="content-search">
                <h1 style="text-align:center;">Search for Rooms</h1>
                <form method="POST" action="{{ url_for('search') }}" class="search-form" style="text-align:center;">
                    <input type="text" id="search_query" name="search_query" placeholder="Search by City, State, or keyword" value="{{ search_query }}">
                    <button type="submit"><i class="fa fa-search"></i> Search</button>
                </form>

                <!-- Display search results if any -->
                {% if search_results %}
                    <h2>Search Results</h2>
                    <div class="room-posts">
                        {% for post in search_results %}
                            <div class="room-post">
                                {% if post.photos %}
                                    {% set photo_paths = post.photos.split(',') %}
                                    {% for photo in photo_paths %}
                                        <img src="{{ url_for('static', filename='uploads/' ~ photo.strip()) }}" alt="Room Photo">
                                    {% endfor %}
                                {% else %}
                                    <img src="{{ url_for('static', filename='images/default_room.jpg') }}" alt="Default Room Photo">
                                {% endif %}
                                <div class="room-post-details">
                                    <h2>{{ post.title }}</h2>
                                    <p>{{ post.description }}</p>
                                    <p>Location: {{ post.city }}, {{ post.state }}</p>
                                    <p>Cost: ${{ post.rent }}</p>
                                    <p>Roommate Preference: {{ post.gender }}, {{ post.age_group }}, {{ post.smoking }}, {{ post.students_only }}</p>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <!-- Display all room posts if no search results -->
                    <div class="room-posts">
                        {% for post in room_posts %}
                            <div class="room-post">
                                {% if post.photos %}
                                    {% set photo_paths = post.photos.split(',') %}
                                    {% for photo in photo_paths %}
                                        <img src="{{ url_for('static', filename='uploads/' ~ photo.strip()) }}" alt="Room Photo">
                                    {% endfor %}
                                {% else %}
                                    <img src="{{ url_for('static', filename='images/default_room.jpg') }}" alt="Default Room Photo">
                                {% endif %}
                                <div class="room-post-details">
                                    <h2 style="text-transform: uppercase;">{{ post.title }}</h2>
                                    <p>{{ post.description | safe }}.....</p>
                                    <p>Location: {{ post.city }}, {{ post.state }}</p>
                                    <p style="font-weight:bold;">Cost: ${{ post.rent }}   USD/month</p>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
</body>
</html>
